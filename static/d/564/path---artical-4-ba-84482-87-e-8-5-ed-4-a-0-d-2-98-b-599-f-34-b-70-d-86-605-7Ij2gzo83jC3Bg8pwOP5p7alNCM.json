{"data":{"site":{"siteMetadata":{"title":"yoyo","author":"yoyo"}},"markdownRemark":{"id":"4ba84482-87e8-5ed4-a0d2-98b599f34b70","excerpt":"umi 的核心是插件系统，可以写自己的插件针对功能的需要可以去使用修改代码打包配置，修改启动代码，约定目录结构，修改 HTML 等更丰富接口，具体 官方文档 写的挺详细的，这里记录下实际使用。 插件使用 插件可以是一个 npm 包，也可以是路径直接引向一个 JS 的模块。用户通过配置 plugins…","html":"<p>umi 的核心是插件系统，可以写自己的插件针对功能的需要可以去使用修改代码打包配置，修改启动代码，约定目录结构，修改 HTML 等更丰富接口，具体<a href=\"https://umijs.org/zh/plugin/develop.html\">官方文档</a>写的挺详细的，这里记录下实际使用。</p>\n<h2>插件使用</h2>\n<p>插件可以是一个 npm 包，也可以是路径直接引向一个 JS 的模块。用户通过配置 plugins 来使用插件。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// .umirc.js</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'./plugins/test.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> a<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>插件文件默认导出一个模块,第一个参数是 umi 提供的一系列 api，第二个参数是引入的时候传的 options</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span>api<span class=\"token punctuation\">,</span> opts<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>path</h2>\n<p><code class=\"language-text\">api.path</code>能获取到一系列的路径\n<a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3edf6dd985ccf23caf46a6d98d2b909c/748ad/1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 900px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 42.54385964912281%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAHNi1JAxf/EABUQAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEBAAEFAmt//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAFxABAQEBAAAAAAAAAAAAAAAAAQAgMf/aAAgBAQABPyHqTBv/2gAMAwEAAgADAAAAECTP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Qp//EABsQAAICAwEAAAAAAAAAAAAAAAABETEQUXGB/9oACAEBAAE/EI+jQNQXXMWP/9k='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"1\"\n        title=\"\"\n        src=\"/static/3edf6dd985ccf23caf46a6d98d2b909c/769ec/1.jpg\"\n        srcset=\"/static/3edf6dd985ccf23caf46a6d98d2b909c/d9ef2/1.jpg 225w,\n/static/3edf6dd985ccf23caf46a6d98d2b909c/ac97c/1.jpg 450w,\n/static/3edf6dd985ccf23caf46a6d98d2b909c/769ec/1.jpg 900w,\n/static/3edf6dd985ccf23caf46a6d98d2b909c/748ad/1.jpg 1140w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n      />\n  </span>\n  </a></p>\n<h2>最常用的操作，配置改编重新生成缓存文件</h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">api<span class=\"token punctuation\">.</span><span class=\"token function\">onOptionChange</span><span class=\"token punctuation\">(</span>newOpts <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  opts <span class=\"token operator\">=</span> newOpts<span class=\"token punctuation\">;</span>\n  api<span class=\"token punctuation\">.</span><span class=\"token function\">rebuildTmpFiles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>registerMethod</h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">api<span class=\"token punctuation\">.</span><span class=\"token function\">registerMethod</span><span class=\"token punctuation\">(</span><span class=\"token string\">'addCount'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  type<span class=\"token punctuation\">:</span> api<span class=\"token punctuation\">.</span><span class=\"token constant\">API_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ADD</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napi<span class=\"token punctuation\">.</span><span class=\"token function\">addCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napi<span class=\"token punctuation\">.</span><span class=\"token function\">addCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> api<span class=\"token punctuation\">.</span><span class=\"token function\">applyPlugins</span><span class=\"token punctuation\">(</span><span class=\"token string\">'addYooo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// [ 1, 2, 3, 4 ]</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">api<span class=\"token punctuation\">.</span><span class=\"token function\">registerMethod</span><span class=\"token punctuation\">(</span><span class=\"token string\">'modifyCount'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  type<span class=\"token punctuation\">:</span> api<span class=\"token punctuation\">.</span><span class=\"token constant\">API_TYPE</span><span class=\"token punctuation\">.</span><span class=\"token constant\">MODIFY</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napi<span class=\"token punctuation\">.</span><span class=\"token function\">modifyCount</span><span class=\"token punctuation\">(</span>opt <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'opt：'</span><span class=\"token punctuation\">,</span> opt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> a<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//如果是 api.applyPlugins('modifyCount', { a: 1 } ) ，上面执行的opt是undefined</span>\n<span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> api<span class=\"token punctuation\">.</span><span class=\"token function\">applyPlugins</span><span class=\"token punctuation\">(</span><span class=\"token string\">'modifyCount'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> initialValue<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> a<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// opt：{ a: 1 }</span>\n<span class=\"token comment\">// { a: 2 }</span></code></pre></div>\n<p>applyPlugins 可以接受第二个参数，作为执行注册方法的函数参数的接收值，必须 { initialValue }才能被接收到</p>\n<h2>modifyRoutes</h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// /plugins/test.js</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">patchRoutes</span><span class=\"token punctuation\">(</span>routes<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  routes<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>route <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">.</span>routes<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">patchRoutes</span><span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">.</span>routes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">.</span>path <span class=\"token operator\">===</span> <span class=\"token string\">'/b'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        route<span class=\"token punctuation\">.</span>Routes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'./routes/PrivateRoute.js'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'./routes/PrivateRoute2.js'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span>api<span class=\"token punctuation\">,</span> opts<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  api<span class=\"token punctuation\">.</span><span class=\"token function\">modifyRoutes</span><span class=\"token punctuation\">(</span>routes <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">patchRoutes</span><span class=\"token punctuation\">(</span>routes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> routes<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>上面例子会让路径<code class=\"language-text\">/b</code>的页面加载<code class=\"language-text\">./routes/PrivateRoute.js</code>和<code class=\"language-text\">./routes/PrivateRoute2.js</code>2 个 layout 组件，</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> route <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  path<span class=\"token punctuation\">:</span> <span class=\"token string\">'/xxx'</span><span class=\"token punctuation\">,</span>\n  component<span class=\"token punctuation\">:</span> <span class=\"token string\">'/path/to/component'</span><span class=\"token punctuation\">,</span>\n  Routes<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'/permissionControl.js'</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>利用<a href=\"https://umijs.org/zh/plugin/develop.html#modifyroutes\">modifyroutes</a>其实可以做很多关于目录约定的事，比如满足某些条件的时候加载约定 js 的组件：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">route<span class=\"token punctuation\">.</span>Routes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">dirname</span><span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">.</span>component<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'/_mylayout.js'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">_mylayout.js</code>还能顺便注入点 props：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> props <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> children <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span>Children<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">,</span> child <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">cloneElement</span><span class=\"token punctuation\">(</span>child<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> test<span class=\"token punctuation\">:</span> <span class=\"token string\">'test'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>PrivateRoute<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>更深一步，可以结合 umi 自带的约定式路由实现更深入的约定。比如一个页面可以分为<code class=\"language-text\">Head.js</code>、<code class=\"language-text\">Content.js</code>、<code class=\"language-text\">Footer.js</code>等等文件，通过插件将它们组合起来，当然这样这几个组件就没有数据交流了，可以在第一个组件开始通过 React.cloneElement 传入把 props 传给 children，redux 也可以在第一个组件 connect，后面的 props umi 会自动传下去。不过这样的话这几个组件之间交流起来就麻烦了，，只能通过 React.cloneElement 传给下一层，所以如果要这样约定目录，最好是分成几块不相干的布局组件，不然会迎引来不必要的麻烦。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">route<span class=\"token punctuation\">.</span>Routes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token function\">dirname</span><span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">.</span>component<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'/Head.js'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">dirname</span><span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">.</span>component<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'/Content.js'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">dirname</span><span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">.</span>component<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'/Footer.js'</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>onPatchRoute 也能做到和 modifyroutes 类似的事，后面再研究有什么区别。\n感觉 onPatchRoute 是遍历 modifyroutes 的时候<strong>顺便暴露</strong>出来的单层路由</p>\n<p>从 umi-plugin-react 中<a href=\"https://github.com/umijs/umi/blob/master/packages/umi-plugin-react/src/plugins/title/index.js#L23\">关于 title 部分的插件</a>来看，一般是在 modifyroutes 里修改 routes，在 onPatchRoute 里向 Routes 中添加组件路径使得可以给路由添加一层封装。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">api<span class=\"token punctuation\">.</span><span class=\"token function\">onPatchRoute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> route <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>route<span class=\"token punctuation\">.</span>routes <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>route<span class=\"token punctuation\">.</span>routes<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">.</span>path <span class=\"token operator\">===</span> <span class=\"token string\">'/b'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      route<span class=\"token punctuation\">.</span>Routes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        path<span class=\"token punctuation\">.</span><span class=\"token function\">dirname</span><span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">.</span>component<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'/Header.js'</span><span class=\"token punctuation\">,</span>\n        path<span class=\"token punctuation\">.</span><span class=\"token function\">dirname</span><span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">.</span>component<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'/Content.js'</span><span class=\"token punctuation\">,</span>\n        path<span class=\"token punctuation\">.</span><span class=\"token function\">dirname</span><span class=\"token punctuation\">(</span>route<span class=\"token punctuation\">.</span>component<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'/Footer.js'</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>addRendererWrapperWithModule</h2>\n<p>接收一个路径在挂载 前执行一个 Module，支持异步。就是在入口文件<code class=\"language-text\">.umi/umi.js</code>里引入指定模块，在挂载前先执行一次。（绝对路径，相对路径的话会以<code class=\"language-text\">.umi/umi.js</code>为基准）。<code class=\"language-text\">.umi/umi.js</code>里大概会生成以下代码：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> moduleBeforeRendererPromises <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> moduleBeforeRenderer0 <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> promiseOfmoduleBeforeRenderer0 <span class=\"token operator\">=</span> <span class=\"token function\">moduleBeforeRenderer0</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>promiseOfmoduleBeforeRenderer0 <span class=\"token operator\">&amp;&amp;</span> promiseOfmoduleBeforeRenderer0<span class=\"token punctuation\">.</span>then<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    moduleBeforeRendererPromises<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>promiseOfmoduleBeforeRenderer0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nPromise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>moduleBeforeRendererPromises<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>err <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">'development'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// render()</span></code></pre></div>\n<h2>modifyEntryRender</h2>\n<p>修改<code class=\"language-text\">.umi/umi.js</code>里的 render 部分的代码，接受个函数参数，参数为原来的代码，可以进行替换或新增</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">api<span class=\"token punctuation\">.</span><span class=\"token function\">modifyEntryRender</span><span class=\"token punctuation\">(</span>memo <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>memo<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n    console.log(111111111)\n`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 编译后的umi.js</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">oldRender</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> rootContainer <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>g_plugins<span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token string\">'rootContainer'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    initialValue<span class=\"token punctuation\">:</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./router'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  ReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>rootContainer<span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">111111111</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>writeTmpFile</h2>\n<p>快捷得在<code class=\"language-text\">.umi</code>文件夹里生成文件（官方文档未指出该 api），一般配合<a href=\"https://umijs.org/zh/plugin/develop.html#ongeneratefiles\">onGenerateFiles</a>使用：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">api<span class=\"token punctuation\">.</span><span class=\"token function\">onGenerateFiles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  api<span class=\"token punctuation\">.</span><span class=\"token function\">writeTmpFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">'aaaa.js'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'1212'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","frontmatter":{"title":"umi插件笔记","date":"2018.11.15"}}},"pageContext":{"slug":"/artical/4ba84482-87e8-5ed4-a0d2-98b599f34b70/","previous":{"id":"d9f3f30c-e226-563c-a90c-668f3151def4","frontmatter":{"title":"gulp笔记","tags":["gulp"]},"fields":{"slug":"/artical/d9f3f30c-e226-563c-a90c-668f3151def4/","tagSlugs":["/tags/gulp/"]}},"next":{"id":"d6df7d43-9a51-5cee-8122-0ea4b9683226","frontmatter":{"title":"nodejs编写命令行工具","tags":["nodejs"]},"fields":{"slug":"/artical/d6df7d43-9a51-5cee-8122-0ea4b9683226/","tagSlugs":["/tags/nodejs/"]}},"limit":10}}